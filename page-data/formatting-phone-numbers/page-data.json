{"componentChunkName":"component---src-templates-blog-post-js","path":"/formatting-phone-numbers/","result":{"data":{"site":{"siteMetadata":{"title":"rafhun"}},"markdownRemark":{"id":"727a9696-137f-5a7b-8a51-c839606e48cd","excerpt":"This article shows how to format a string of numbers and format it for use in  attributes and make them more readable for visitors. The concrete examples show…","html":"<p>This article shows how to format a string of numbers and format it for use in <code class=\"language-text\">href</code> attributes and make them more readable for visitors. The concrete examples show how to integrate this with WordPress however the principles can be applied to any application.</p>\n<h2>Clean up the string</h2>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">cleanPhoneNumber</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$phone_number</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Strip out all spaces</span>\n    <span class=\"token variable\">$number</span> <span class=\"token operator\">=</span> <span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token function\">str_replace</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">' '</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$phone_number</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Make sure there is no (0) in the phone number</span>\n    <span class=\"token variable\">$number</span> <span class=\"token operator\">=</span> <span class=\"token function\">str_replace</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'(0)'</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$number</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// This is an educated guess about whether or not we have an international prefix.</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$number</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!==</span> <span class=\"token single-quoted-string string\">'+'</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$number</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!==</span> <span class=\"token single-quoted-string string\">'00'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// If the number starts with a 0 this is probably the region prefix, which must be removed</span>\n        <span class=\"token comment\">// if there is an international prefix.</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$number</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token single-quoted-string string\">'0'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token variable\">$number</span> <span class=\"token operator\">=</span> <span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$number</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token variable\">$number</span> <span class=\"token operator\">=</span> <span class=\"token single-quoted-string string\">'+41'</span> <span class=\"token punctuation\">.</span> <span class=\"token variable\">$number</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token variable\">$number</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>This function, which in the WordPress environment can be hooked up to a custom filter, cleans up a given number according to a few rules.</p>\n<ol>\n<li>Remove whitespace and trim the number.</li>\n<li>Some people enter the state prefix as <code class=\"language-text\">(0)</code>. Since we add an international prefix where this is unecessary anyways, we just strip it.</li>\n<li>We are checking for an international prefix. The function assumes it exists if the string starts with <code class=\"language-text\">+</code> or <code class=\"language-text\">00</code> which is the common way to write these in Switzerland. Of course to be cleaner you could check against a database, in any case make sure to adjust this to your local customs.</li>\n<li>If there is no prefix, check the first number, if it is a 0 we assume it to be the state prefix which needs to be removed.</li>\n<li>If there is no international prefix we add the Swiss prefix by default. If necessary add this as a function argument or check the region programmatically and set it from that information.</li>\n</ol>\n<p>We expect the function to turn i. e. <code class=\"language-text\">012 345 67 89</code> (custom Swiss phone number format without international prefix) into <code class=\"language-text\">+41123456789</code>. The output is the same if the number is input as <code class=\"language-text\">0041 12 345 67 89</code> or <code class=\"language-text\">+41 12 345 67 89</code>.</p>\n<h2>Format the string</h2>\n<p>To get consistent and readable output of phone numbers you can make use of this second function.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">function</span> <span class=\"token function\">formatPhoneNumber</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$phone_number</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Add a fallback, in case these transformations do not return a result</span>\n    <span class=\"token comment\">// (i. e. the phone number format is not recognized).</span>\n    <span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$phone_number</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n     * Clean up the phone number (make sure we have no spaces, an international prefix, etc.).\n     *\n     * Call it directly or use the filter\n     */</span>\n    <span class=\"token variable\">$number</span> <span class=\"token operator\">=</span> <span class=\"token function\">cleanPhoneNumber</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$phone_number</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n     * Do some checks for possible phone number formats using preg_match, then add spaces where necessary.\n     */</span>\n\n    <span class=\"token comment\">// Swiss phone number format.</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">preg_match</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'/^(\\+\\d{2})(\\d{2})(\\d{3})(\\d{2})(\\d{2})$/'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$number</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$matches</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$matches</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">.</span> <span class=\"token single-quoted-string string\">'&amp;nbsp;'</span> <span class=\"token punctuation\">.</span>\n            <span class=\"token variable\">$matches</span><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">.</span> <span class=\"token single-quoted-string string\">'&amp;nbsp;'</span> <span class=\"token punctuation\">.</span>\n            <span class=\"token variable\">$matches</span><span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">.</span> <span class=\"token single-quoted-string string\">'&amp;nbsp;'</span> <span class=\"token punctuation\">.</span>\n            <span class=\"token variable\">$matches</span><span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">.</span> <span class=\"token single-quoted-string string\">'&amp;nbsp;'</span> <span class=\"token punctuation\">.</span>\n            <span class=\"token variable\">$matches</span><span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// German phone number format.</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">preg_match</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'/^(\\+\\d{2})(\\d{4})(\\d{6})(\\d{1,2})$/'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$number</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$matches</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$matches</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">.</span> <span class=\"token single-quoted-string string\">'&amp;nbsp;'</span> <span class=\"token punctuation\">.</span>\n            <span class=\"token variable\">$matches</span><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">.</span> <span class=\"token single-quoted-string string\">'&amp;nbsp;'</span> <span class=\"token punctuation\">.</span>\n            <span class=\"token variable\">$matches</span><span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">.</span> <span class=\"token single-quoted-string string\">'&amp;nbsp;'</span> <span class=\"token punctuation\">.</span>\n            <span class=\"token variable\">$matches</span><span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token variable\">$result</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Again in a WordPress environment you could add this function to custom filter. Here is what the function is set up to do in the example.</p>\n<ol>\n<li>Store the original input in a variable in case we cannot return valid output.</li>\n<li>Clean up the given string to make sure it has an international prefix and no spaces. Call the above function (<code class=\"language-text\">cleanPhoneNumber</code>) directly or use the filter you hooked it to if in WordPress.</li>\n<li>Do some <code class=\"language-text\">preg_match</code> checks, currently for Swiss and German phone number format. What we do is check for number groupings which are then stitched together with non breaking spaces. The expected result is <code class=\"language-text\">+41&amp;nbsp;12&amp;npbs;345&amp;nbsp;67&amp;nbsp;89</code>. For German numbers the groupings and length differs, but it’s the same process.</li>\n</ol>\n<p>You can add more <code class=\"language-text\">preg_match</code> checks for other formats. Manually check the international prefix if phone numbers have the same length but expect different groupings.</p>\n<h2>Example usage</h2>\n<p>This is how you would use these helper functions in a WordPress environment. Say we want to display team members and one piece of information we offer is their phone number stored using an Advanced Custom Field. We put the two functions as public static methods into a Helper class. When collecting data to output you can do the following.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token variable\">$theNumber</span> <span class=\"token operator\">=</span> <span class=\"token function\">get_field</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'phone_number'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$postId</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$cleanNumber</span> <span class=\"token operator\">=</span> Helper<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">cleanPhoneNumber</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$theNumber</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$formatNumber</span> <span class=\"token operator\">=</span> Helper<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">formatPhoneNumber</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$theNumber</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$phoneLink</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token single-quoted-string string\">'href'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token function\">esc_url</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'tel:'</span> <span class=\"token punctuation\">.</span> <span class=\"token variable\">$cleanNumber</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token single-quoted-string string\">'text'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token function\">esc_html</span><span class=\"token punctuation\">(</span><span class=\"token function\">decode_html_entities</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$formatNumber</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></span></code></pre></div>\n<p>Then use this in your views as your templating language expects, or using just PHP:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token keyword\">echo</span> <span class=\"token single-quoted-string string\">'&lt;a href=\"'</span> <span class=\"token punctuation\">.</span> <span class=\"token variable\">$phoneLink</span><span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'href'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">.</span> <span class=\"token single-quoted-string string\">'>'</span> <span class=\"token punctuation\">.</span> <span class=\"token variable\">$phoneLink</span><span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'text'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">.</span> <span class=\"token single-quoted-string string\">'&lt;/a>'</span><span class=\"token punctuation\">;</span></span></code></pre></div>","frontmatter":{"title":"Formatting phone numbers","date":"October 29, 2020","description":null}},"previous":{"fields":{"slug":"/git-to-remember/"},"frontmatter":{"title":"Git to Remember"}},"next":{"fields":{"slug":"/gutenberg-color-picker-setup/"},"frontmatter":{"title":"Custom Blocks with a Color Picker in core v5.5"}}},"pageContext":{"id":"727a9696-137f-5a7b-8a51-c839606e48cd","previousPostId":"1edd2a27-595f-56e0-a170-f6aa5f845b18","nextPostId":"c80cbf01-90a9-56d2-902f-45638e5ce7e3"}},"staticQueryHashes":["1633425274","2841359383"]}