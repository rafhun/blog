{"componentChunkName":"component---src-templates-blog-post-js","path":"/gather-wordpress-post-data/","result":{"data":{"site":{"siteMetadata":{"title":"rafhun"}},"markdownRemark":{"id":"339cfe2d-8a4c-5647-9de3-12ef1990b536","excerpt":"To decouple logic and markup from each other, let’s define a helper class that is in charge of gathering all relevant post data. Basic Class Setup The helper…","html":"<p>To decouple logic and markup from each other, let’s define a helper class that is in charge of gathering all relevant post data.</p>\n<h2>Basic Class Setup</h2>\n<p>The helper class should be initialized with a post ID that might be returned from a custom query, some custom fields or any other source. Let’s store this ID in a private variable so we can access it from everywhere.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">namespace</span> <span class=\"token package\">Helpers</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">PostData</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/**\n     * Holds the ID of the current post, assigned in the constructor\n     */</span>\n    <span class=\"token keyword\">private</span> int <span class=\"token variable\">$postId</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n     * The constructor takes in the ID argument and if it seems valid, assigns it to the internal $postId variable.\n     *\n     * @param int $id\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">__construct</span><span class=\"token punctuation\">(</span>int <span class=\"token variable\">$id</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">is_int</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$id</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">postId</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$id</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * Collect data about the job, optionally metas only\n     *\n     * @param boolean $detailed Collect all data about the job\n     *\n     * @return object Data object containing some data about the job\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getData</span><span class=\"token punctuation\">(</span>bool <span class=\"token variable\">$detailed</span> <span class=\"token operator\">=</span> <span class=\"token boolean constant\">true</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'post-type-slug'</span> <span class=\"token operator\">!==</span> <span class=\"token function\">get_post_type</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">postId</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Bail if the post has the wrong post type</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean constant\">false</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token comment\">// Gather data</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>As seen above the next step is a generalized <code class=\"language-text\">getData</code> function. This is where we collect everything we need for displaying the post.</p>\n<p>Add the <code class=\"language-text\">$detailed</code> argument if you wish to differentiate which data is gathered dependent on the context. You could for example use the detailed data on a single view while only gathering more general data on archive pages.</p>\n<h2>Gathering Simple Data</h2>\n<p>With simple data we mean the information we can fully access using basic WordPress functions and that does not need to be manipulated. Let’s continue the above example.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">namespace</span> <span class=\"token package\">Helpers</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">PostData</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getData</span><span class=\"token punctuation\">(</span>bool <span class=\"token variable\">$detailed</span> <span class=\"token operator\">=</span> <span class=\"token boolean constant\">true</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n\n    <span class=\"token comment\">// Initialize the data object that stores all information</span>\n    <span class=\"token variable\">$data</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>object<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token variable\">$data</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">title</span> <span class=\"token operator\">=</span> <span class=\"token function\">html_entity_decode</span><span class=\"token punctuation\">(</span><span class=\"token function\">get_the_title</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">postId</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$data</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">permalink</span> <span class=\"token operator\">=</span> <span class=\"token function\">get_permalink</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">postId</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$data</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">excerpt</span> <span class=\"token operator\">=</span> <span class=\"token function\">get_the_excerpt</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">postId</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Continue data collection as necessary</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token variable\">$data</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>Advanced Data</h2>\n<p>There is some data that you might need or want to manipulate before sending it to a template. Let’s look at two useful examples.</p>\n<h3>Date</h3>\n<p>To properly add a date to your post you need to generate two date formats, one for computers (used in the <code class=\"language-text\">datetime</code> attribute) and on formatted for humans.</p>\n<p>The following method gets that data and makes it available in an object.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">namespace</span> <span class=\"token package\">Helpers</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">PostData</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token comment\">/**\n    * Return the information necessary to display a proper date.\n    *\n    * @return object Contains the date information as `attribute` and `text`\n    */</span>\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getDate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">{</span>\n      <span class=\"token variable\">$date</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>object<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n      <span class=\"token variable\">$date</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">attribute</span> <span class=\"token operator\">=</span> <span class=\"token function\">get_post_time</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'c'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean constant\">true</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">postId</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token variable\">$date</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">text</span> <span class=\"token operator\">=</span> <span class=\"token function\">get_the_date</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">postId</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">return</span> <span class=\"token variable\">$date</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>All we are doing here is using two core WordPress functions and storing its returns into an object. Call this in the <code class=\"language-text\">getData</code> method if you need date information.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token variable\">$data</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">date</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">getDate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>Taxonomy Terms</h3>\n<p>In order for this to work properly for any taxonomies (categories, tags, custom taxonomies) it is best to use a generalized helper method. Call it directly and provide the taxonomy slug as argument or set up a secondary helper method where the taxonmy slug is hardcoded.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">namespace</span> <span class=\"token package\">Helpers</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">PostData</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token comment\">/**\n    * Returns an array of objects containing the name and link of all terms of a specific taxonomy that are assigned to the current post.\n    *\n    * @param string $taxonomySlug\n    *\n    * @return array\n    */</span>\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getTermData</span><span class=\"token punctuation\">(</span>string <span class=\"token variable\">$taxonomySlug</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">{</span>\n      <span class=\"token variable\">$getTerms</span> <span class=\"token operator\">=</span> <span class=\"token function\">get_the_terms</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">postId</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$taxonomySlug</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token variable\">$getTerms</span> <span class=\"token operator\">||</span> <span class=\"token function\">is_wp_error</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$getTerms</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean constant\">false</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token variable\">$terms</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$getTerms</span> <span class=\"token keyword\">as</span> <span class=\"token variable\">$theTerm</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token variable\">$term</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>object<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n          <span class=\"token variable\">$term</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">name</span> <span class=\"token operator\">=</span> <span class=\"token function\">html_entity_decode</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$theTerm</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">name</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token variable\">$term</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">link</span> <span class=\"token operator\">=</span> <span class=\"token function\">get_term_link</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$theTerm</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token variable\">$terms</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$term</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token keyword\">return</span> <span class=\"token variable\">$terms</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>What we are doing here is simply making use of the <code class=\"language-text\">get_the_terms</code> function providing our stored post ID and the given taxonomy slug. If any terms of the taxonomy are assigned to this post it will return an array of term objects. We return false if no terms could be found.</p>\n<p>Next we initialize our own terms array which we then populate with reduced term objects. Loop through the returned terms using <code class=\"language-text\">foreach</code> then extract whatever information you need into the <code class=\"language-text\">$term</code> object. In this example we are getting the name and link to the archive of each term and then add the whole object to our <code class=\"language-text\">$terms</code> array.</p>\n<p>If you want to call this helper indirectly add the following method.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">/**\n  * Gets the terms assigned from the `taxonomy-slug` taxonomy.\n  *\n  * @return array Contains objects with information about a term (name, link)\n  */</span>\n<span class=\"token keyword\">private</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getTaxonomyName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$terms</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">getTermData</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'taxonomy-slug'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token variable\">$terms</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>In <code class=\"language-text\">getData</code> you can then call it as follows.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">// Using a named helper</span>\n<span class=\"token variable\">$data</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">taxonomyName</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">getTaxonomyName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Directly using getTermData</span>\n<span class=\"token variable\">$data</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">otherTaxonomy</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">getTermData</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'other-taxonomy'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Usage</h2>\n<p>Make sure to format the <code class=\"language-text\">$data</code> variable you return in a way that your templating system understands. Then wherever you want to make use of this data do the following.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">// examplary: this assumes you are in a loop</span>\n<span class=\"token variable\">$postId</span> <span class=\"token operator\">=</span> <span class=\"token function\">get_the_ID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$postDataObject</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Helpers<span class=\"token punctuation\">\\</span>PostData</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$postId</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$postData</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$postDataObject</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">getData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Now hand it to your templates</span></code></pre></div>","frontmatter":{"title":"Gather Post Data in WordPress","date":"November 03, 2020","description":null}},"previous":{"fields":{"slug":"/update-docker-image/"},"frontmatter":{"title":"Update Your Docker Image"}},"next":{"fields":{"slug":"/gutenberg-dynamic-blocks-color/"},"frontmatter":{"title":"Using colors in dynamic blocks"}}},"pageContext":{"id":"339cfe2d-8a4c-5647-9de3-12ef1990b536","previousPostId":"430dd4c2-9110-5187-a2f7-6b6d0be46395","nextPostId":"8749e48c-78d4-589e-bf3e-13538e921663"}},"staticQueryHashes":["1633425274","2841359383"]}